version: 2

workflows:
  version: 2
  test:
    jobs:
      - test-netstandard2.0
      - test-android

jobs:  
  test-netstandard2.0:
    docker:
      - image: microsoft/dotnet:2.0-sdk-jessie
    steps:
      - checkout
      - run: dotnet restore
      - run: dotnet build src/LaunchDarkly.XamarinSdk -f netstandard2.0
      - run: dotnet test tests/LaunchDarkly.XamarinSdk.Tests/LaunchDarkly.XamarinSdk.Tests.csproj -f netcoreapp2.0

  test-android:
    macos:
      xcode: "10.2.1"

    environment:
      ANDROID_SDK_ROOT: "/usr/local/share/android-sdk"

    steps:
      - run:
          name: Set up package source for Xamarin tools
          command: brew install caskroom/cask/brew-cask

      - run:
          name: Install Xamarin tools
          command: brew cask install xamarin xamarin-android xamarin-ios android-sdk && brew install mono
          # Note, "mono" provides the msbuild CLI tool

      - run:
          name: Install Android SDK components
          command: yes | $ANDROID_SDK_ROOT/tools/bin/sdkmanager "system-images;android-24;default;armeabi-v7a"

      - checkout

      - run:
          name: Build SDK
          command: msbuild /restore
